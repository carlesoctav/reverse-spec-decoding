# RSD Data Generation Configuration
# Reverse Speculative Decoding: Teacher-Proposed, Student-Approved

# Teacher model (proposes tokens)
teacher:
  model: google/gemma-3-27b-it
  dtype: bfloat16
  max_model_len: 4096
  trust_remote_code: true
  gpu_memory_utilization: 0.7
  custom_chat_template: null  # null = use tokenizer's default template

# Student model (verifies tokens)
student:
  model: google/gemma-3-1b-it
  dtype: bfloat16
  max_model_len: 4096
  trust_remote_code: true
  gpu_memory_utilization: 0.2
  custom_chat_template: gemma_think.jinja

# Teacher sampling (greedy for reproducibility)
teacher_sampling:
  max_tokens: 1
  temperature: 0.0
  logprobs: 25
  top_p: 1.0
  top_k: -1

# Student sampling (greedy fallback when rejecting)
student_sampling:
  max_tokens: 1
  temperature: 1.0
  logprobs: 25
  top_p: 1.0
  top_k: -1

# Dataset configuration
dataset:
  sources:
    - path: openai/gsm8k
      name: main
      split: train
      prompt_column: question
      response_column: answer
  start_idx: 0
  end_idx: null  # null = process all

# RSD parameters
threshold: 0.1      # 10% - reject teacher token if P_s(y) < 0.1
max_tokens: 2048    # Max tokens per generation
lookahead: 8        # Teacher generates 8 tokens, student verifies in batch

# Output
output: rsd_traces.jsonl

# Hub upload (optional - set to null to skip)
push_to_hub: null  # e.g., "your-username/gsm8k-rsd-traces"
